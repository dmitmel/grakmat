import java.text.SimpleDateFormat

group   'org.codream.grakmat'
version '1.0'


def gmtDateFormat   = new SimpleDateFormat('EEE, MMM d, yyyy HH:mm:ss a z')
def buildDateString = gmtDateFormat.format(new Date())


buildscript {
    ext {
        kotlinVersion = '1.0.4'
        junitVersion = '4.12'
        dokkaVersion = '0.9.9'
    }
    
    repositories {
        mavenLocal()
        mavenCentral()
        jcenter()
    }
    
    dependencies {
        classpath "org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlinVersion"
        classpath "org.jetbrains.dokka:dokka-gradle-plugin:$dokkaVersion"
    }
}


apply plugin: 'kotlin'
apply plugin: 'org.jetbrains.dokka'


repositories {
    mavenLocal()
    mavenCentral()
}

dependencies {
    compile "org.jetbrains.kotlin:kotlin-stdlib:$kotlinVersion"
    compile "junit:junit:$junitVersion"
}


sourceSets {
    main { output.resourcesDir = output.classesDir }
    test { output.resourcesDir = output.classesDir }
}


jar {
    manifest {
        attributes(
                'Gradle-Version'  : '2.14.1',
                'Built-On'        : buildDateString,
                'Artifact-Version': project.version,
                'Group-ID'        : project.group,
                'Artifact-ID'     : project.name
        )
    }
    
    // Removing duplicate files in JARs. Somehow, 'jar' puts '.class' files into JAR 2 times. To prevent this,
    // I removed build location in first time, and added it in second time
    doFirst { sourceSets['main'].output.classesDir = null }                                    // 1st time
    doLast  { sourceSets['main'].output.classesDir = sourceSets['main'].output.classesDir }    // 2nd time
}


dokka {
    sourceDirs = files("$projectDir/src/main/kotlin")
//    outputFormat = 'html-as-java'
}
